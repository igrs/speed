原文：https://developers.google.com/speed/docs/best-practices/rendering


## CSS をドキュメントヘッドに含める

### 概要

インラインスタイルと`<link>`はbodyからheadへ移動させるとレンダリングが改善される。

### 詳細

インラインスタイルと外部CSSをHTMLのbodyに記述することはレンダリングパフォーマンスに悪影響を与える。ブラウザーはすべての外部CSSが読み込まれるまでページのレンダリングをブロックする。
`<style>`タグで記述されたインラインスタイルはリフローを発生させるので、インラインスタイルも同様にページのheadで外部CSSを参照することが重要だ。スタイルシートが一番最初にダウンロード・パースされることによって、ブラウザーのプログレッシブレンダリングが可能となる。

### 推奨

+ HTML4.01仕様書（[section12.3](http://www.w3.org/TR/html4/struct/links.html#h-12.3)）によると、外部CSSは常に `<head>` 内に `<link>` タグで記述すると書かれており、`@import`は使用しない。またスクリプトとスタイルシートを正しい順序で記述する。
+ `<style>` タグも `<head>` 部分に記述する。



## 画像のサイズを指定する

### 概要

すべての画像にwidthとheightを指定することは、不必要なリフロー・リペイントを発生させないためレンダリングが速くなる。

### 詳細

ブラウザーがページレイアウトをするとき、画像のような置換要素の周りではフローが発生する。それは非置換要素のサイズがわかれば、画像がダウンロードされる前であってもレンダリングを開始することができる。もしドキュメント内でサイズが指定されていない、実際の画像サイズと異なる場合、ブラウザーは画像をダウンロードした後にリフロー・リペイントを行わければならない。リフローを防ぐために、 HTMLの`<img>`タグまたはCSSですべての画像にwidthとheightを明示する。


### 推奨

__実際の画像サイズにマッチしたサイズを指定する __  
動的にサイズを変更したwidth/heightを指定すべきではない。実際の画像ファイルが60×60ピクセルならば、30×30サイズのようなサイズをHTMLまたはCSSで指定しない。もし画像を小さくする必要があるのであれば画像編集ツールで変更し、実際の画像とマッチしたサイズを指定する（詳細は[画像を最適化する](http://localhost:4000/speed/payload/CompressImages.html)を参照）。


__必ず画像要素または親のブロックレベル要素にサイズを指定する __  
必ず`<img>`要素自身または親のブロックレベル要素にサイズを指定する。もし、親要素がブロック要素でなければ、サイズは無視される。また直接の親ではない祖先要素に対してはサイズは指定しない。


## 文字セットを指定する
### 概要

HTTPレスポンスヘッダーで文字セットを明示することは、HTMLパース・スクリプト実行を早めてくれる。

### 詳細

HTMLドキュメントは、文字エンコーディング情報を伴う一連のバイトとしてインターネット経由で送信される。文字エンコーディング情報はHTTPレスポンスヘッダーまたはドキュメントのマークアップ内で特定される。ブラウザーはレンダリングするために、文字エンコーディング情報をバイトから文字列に変換する際に使用する。ブラウザーはページの文字情報を知ることなしに、正確にレンダリングできないため、多くのブラウザーは入力中に文字情報を検索しながら、JavaScriptの実行やページの描画前にいくつかのバイトをバッファリングします（注目すべき例外はInternet Explorer6, 7, 8）。

 ブラウザーによってバッファリングするバイト数は異なり、もし文字セットがなかった場合はデフォルトのエンコーディングを使用します。しかし、ひとたび必要なバイト量をバッファリングすればページのレンダリングを始めてしまうので、もし、デフォルトのエンコーディングと違う文字セットが指定されていたのなら再度パースをし、ページの再描画をしてしまう。時には、ミスマッチは外部リソースのURLにも影響するので、再リクエストをしなければならないかもしれない。

 これらの遅延を避けるために、あなた常に、文字エンコーディングをHTTPレスポンスヘッダーに明示しなければならない。文字エンコーディングはmeta http-equivタグでも指定可能だが、メタタグ指定では、Internet Explorer 8において*Lookahead Downloaderを無効*にする。先読みダウンローダーの無効化は実質的に、ページの読み込み時間を増加させてしまう。[マイクロソフトは](http://blogs.msdn.com/b/ieinternals/archive/2010/04/01/ie8-lookahead-downloader-fixed.aspx)、「私たちはWebデベロッパーに対して、HTTP Content-TypeレスポンスヘッダーでCHARSETの指定を強く推奨している。なぜならそうすることで、Lookahead Downloaderのメリットを保証するからだ」と述べていることに注意してもらいたい。

### 推奨

__常にコンテンツタイプを指定する __  
ブラウザー文字セットをチェックする前に、最初に処理しているドキュメントのコンテンツタイプを決定しなければならない。もし、この指定がHTTPヘッダー、HTMLのメタタグで指定されていない場合は、ブラウザーはさまざまなアルゴリズムを使い推測しようとする。このプロセスは余計な遅延を引き起こし、セキュリティに脆弱性にもつながる可能性がある。パフォーマンスとセキュリティの面から、常に（text/htmlだけでなく）すべてのリソースに対してコンテンツタイプを指定する。

__正しい文字エンコーディングがセットされていることを確認する __  
HTTPヘッダーもしくはHTMLのメタタグで実際のドキュメントと同じ文字エンコーディングを指定することは重要だ。もしHTTPヘッダーとHTMLメタタグの両方で文字セットを指定するのなら、両方同じものかどうか確かめる。もし、ブラウザーが不正確または不一致なエンコーディングを検出した場合、ページの描画は不正確になり、再描画する遅延も発生する。詳細な文字セットに関する情報は、[HTML4.01仕様書](http://www.w3.org/TR/REC-html40/)の [Section 5.2, Character Encodings](http://www.w3.org/TR/REC-html40/charset.html#h-5.2) を参照すると良いだろう。

### Additional resources 

+ [Page Speed wiki](http://code.google.com/p/page-speed/wiki/SpecifyCharsetEarly)
+ [Browser Performance Issues with Charsets](http://zoompf.com/2009/12/browser-performance-issues-with-charsets)
+ [Performance Implications of "charset"](http://www.kylescholz.com/blog/2010/01/performance_implications_of_charset.html)